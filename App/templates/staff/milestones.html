{% extends "layout.html" %}
{% block title %}Manage Milestones - Service Hours Tracker{% endblock %}
{% block page %}Milestones{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px;">
  <div class="card">
    <div class="card-content">
      <!-- Header with Back Button -->
      <div style="margin-bottom: 24px;">
        <a href="/staff/main" style="color: #9e9e9e; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
          <i class="material-icons" style="font-size: 18px;">arrow_back</i>
          Back to Main Menu
        </a>
      </div>

      <!-- Title and Create Button -->
      <div class="row" style="border-bottom: 2px solid #424242; padding-bottom: 16px; margin-bottom: 24px;">
        <div class="col s8">
          <h4 style="color: #424242; margin: 0;">Manage Milestones</h4>
        </div>
        <div class="col s4 right-align">
          <a href="/staff/create-milestone" class="btn waves-effect waves-light" style="background-color: var(--btn-bg); color: var(--btn-text);">
            <i class="material-icons left">add</i>
            Create New Milestone
          </a>
        </div>
      </div>

      <!-- Milestones Table -->
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background-color: #424242; color: #ffffff;">
              <th style="padding: 16px; text-align: left; border: 1px solid #424242;">Hours Required</th>
              <th style="padding: 16px; text-align: left; border: 1px solid #424242;">Students Achieved</th>
              <th style="padding: 16px; text-align: center; border: 1px solid #424242;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for milestone in milestones %}
            <tr style="background-color: {% if loop.index % 2 == 0 %}#f5f5f5{% else %}#ffffff{% endif %}; border: 1px solid #e0e0e0;">
              <td style="padding: 16px; border: 1px solid #e0e0e0; color: var(--text-color);">{{ milestone.hours }} hours</td>
              <td style="padding: 16px; border: 1px solid #e0e0e0; color: var(--text-color);">{{ milestone.student_count | default(0) }}</td>
              <td style="padding: 16px; border: 1px solid #e0e0e0; text-align: center;">
                <a href="/staff/edit-milestone/{{ milestone.id }}" style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border: 2px solid #424242; background-color: #ffffff; color: #424242; text-decoration: none; margin-right: 12px; cursor: pointer; transition: all 0.3s;">
                  <i class="material-icons" style="font-size: 20px;">edit</i>
                </a>
                <a href="#delete-modal-{{ milestone.id }}" class="modal-trigger" style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border: 2px solid #ef5350; background-color: #ef5350; color: #ffffff; text-decoration: none; cursor: pointer; transition: all 0.3s;">
                  <i class="material-icons" style="font-size: 20px;">delete</i>
                </a>
                
                <!-- Delete Modal -->
                <div id="delete-modal-{{ milestone.id }}" class="modal">
                  <div class="modal-content">
                    <h4>Delete Milestone?</h4>
                    <p>Are you sure you want to delete the <strong>{{ milestone.hours }} Hours Milestone</strong>?</p>
                  </div>
                  <div class="modal-footer">
                    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
                    <form method="POST" action="/staff/delete-milestone/{{ milestone.id }}" style="display: inline;">
                      <button type="submit" class="waves-effect waves-red btn red">Delete</button>
                    </form>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Info Card -->
      <div class="card-panel" style="border: 2px solid var(--border-color); margin-top: 32px; background-color: var(--card-panel-bg);">
        <h5 style="color: #424242; margin-bottom: 12px;">About Milestones</h5>
        <p style="color: var(--secondary-text); margin: 0;">
          Milestones are automatically awarded to students when they reach the specified number of service hours. Students can view their progress toward each milestone on their profile. You can create new milestones, edit existing ones, or remove milestones that are no longer needed.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Initialize Materialize Modals -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var modals = document.querySelectorAll('.modal');
    M.Modal.init(modals);
  });
</script>
{% endblock %}
