{% extends "layout.html" %}
{% block title %}Change Password - Service Hours Tracker{% endblock %}
{% block page %}Change Password{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px;">
  <div class="card">
    <div class="card-content">
      <!-- Back Button -->
      <div style="margin-bottom: 24px;">
        <a href="/student/profile" class="btn waves-effect waves-light" style="background-color: transparent !important; color: var(--text-color) !important; border: 2px solid var(--border-color);">
          <i class="material-icons left">arrow_back</i>
          Back to Profile
        </a>
      </div>

      <h4 style="color: var(--text-color); margin-bottom: 24px;">Change Password</h4>

      <form method="POST" action="/student/change-password" style="max-width: 400px;">
        <!-- Current Password -->
        <div style="margin-bottom: 24px;">
          <label for="current_password" style="color: var(--secondary-text); font-weight: bold; display: block; margin-bottom: 8px;">Current Password</label>
          <input placeholder="Enter current password" id="current_password" name="current_password" type="password" class="validate" required style="background-color: var(--bg-color); color: var(--text-color); border: 2px solid var(--border-color); padding: 12px; border-radius: 4px; width: 100%; box-sizing: border-box;">
        </div>

        <!-- New Password -->
        <div style="margin-bottom: 24px;">
          <label for="new_password" style="color: var(--secondary-text); font-weight: bold; display: block; margin-bottom: 8px;">New Password</label>
          <input placeholder="Enter new password" id="new_password" name="new_password" type="password" class="validate" required style="background-color: var(--bg-color); color: var(--text-color); border: 2px solid var(--border-color); padding: 12px; border-radius: 4px; width: 100%; box-sizing: border-box;">
        </div>

        <!-- Confirm New Password -->
        <div style="margin-bottom: 24px;">
          <label for="confirm_password" style="color: var(--secondary-text); font-weight: bold; display: block; margin-bottom: 8px;">Confirm New Password</label>
          <input placeholder="Re-enter new password" id="confirm_password" name="confirm_password" type="password" class="validate" required style="background-color: var(--bg-color); color: var(--text-color); border: 2px solid var(--border-color); padding: 12px; border-radius: 4px; width: 100%; box-sizing: border-box;">
        </div>

        <!-- Password Requirements -->
        <div style="margin-bottom: 32px; padding: 16px; background-color: var(--card-panel-bg); border: 2px solid var(--border-color); border-radius: 8px;">
          <div style="color: var(--text-color); font-weight: bold; margin-bottom: 8px;">Password Requirements:</div>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li id="req-length" style="margin-bottom: 4px; color: #f44336; font-weight: 500;">At least 8 characters long</li>
            <li id="req-uppercase" style="margin-bottom: 4px; color: #f44336; font-weight: 500;">Contains uppercase letter</li>
            <li id="req-lowercase" style="margin-bottom: 4px; color: #f44336; font-weight: 500;">Contains lowercase letter</li>
            <li id="req-number" style="margin-bottom: 4px; color: #f44336; font-weight: 500;">Contains number</li>
            <li id="req-special" style="margin-bottom: 4px; color: #f44336; font-weight: 500;">Contains special character</li>
          </ul>
        </div>

        <!-- Buttons -->
        <div style="display: flex; gap: 16px;">
          <button type="submit" id="submit-btn" class="btn waves-effect waves-light" style="flex: 1; background-color: var(--btn-bg) !important; color: var(--btn-text) !important;" disabled>
            Change Password
          </button>
          <a href="/student/profile" class="btn waves-effect waves-light" style="flex: 1; background-color: transparent !important; color: var(--text-color) !important; border: 2px solid var(--border-color);">
            Cancel
          </a>
        </div>
      </form>

      <!-- Security Tip -->
      <div style="margin-top: 32px; padding: 16px; background-color: rgba(255, 255, 0, 0.1); border: 2px solid var(--border-color); border-radius: 8px;">
        <p style="color: var(--text-color); margin: 0;">
          <strong>Security Tip:</strong> Use a strong, unique password that you don't use on other websites.
        </p>
      </div>

    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPasswordInput = document.getElementById('new_password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const submitBtn = document.getElementById('submit-btn');
    const requirements = {
        length: document.getElementById('req-length'),
        uppercase: document.getElementById('req-uppercase'),
        lowercase: document.getElementById('req-lowercase'),
        number: document.getElementById('req-number'),
        special: document.getElementById('req-special')
    };

    function checkPassword() {
        const password = newPasswordInput.value;

        // Length check
        const hasLength = password.length >= 8;
        requirements.length.style.color = hasLength ? '#4caf50' : '#f44336';

        // Uppercase check
        const hasUppercase = /[A-Z]/.test(password);
        requirements.uppercase.style.color = hasUppercase ? '#4caf50' : '#f44336';

        // Lowercase check
        const hasLowercase = /[a-z]/.test(password);
        requirements.lowercase.style.color = hasLowercase ? '#4caf50' : '#f44336';

        // Number check
        const hasNumber = /\d/.test(password);
        requirements.number.style.color = hasNumber ? '#4caf50' : '#f44336';

        // Special character check
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        requirements.special.style.color = hasSpecial ? '#4caf50' : '#f44336';

        // Check if all requirements are met
        updateSubmitButton();
    }

    function updateSubmitButton() {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        // Check all requirements
        const hasLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasLowercase = /[a-z]/.test(password);
        const hasNumber = /\d/.test(password);
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        const passwordsMatch = password === confirmPassword && password.length > 0;
        
        const allRequirementsMet = hasLength && hasUppercase && hasLowercase && hasNumber && hasSpecial && passwordsMatch;
        
        // Enable/disable submit button
        submitBtn.disabled = !allRequirementsMet;
        submitBtn.style.opacity = allRequirementsMet ? '1' : '0.6';
        submitBtn.style.cursor = allRequirementsMet ? 'pointer' : 'not-allowed';
    }

    // Event listeners
    newPasswordInput.addEventListener('input', function() {
        checkPassword();
        updateSubmitButton();
    });

    confirmPasswordInput.addEventListener('input', updateSubmitButton);

    // Form submission validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        // Check all requirements
        const hasLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasLowercase = /[a-z]/.test(password);
        const hasNumber = /\d/.test(password);
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        const passwordsMatch = password === confirmPassword;
        
        const allRequirementsMet = hasLength && hasUppercase && hasLowercase && hasNumber && hasSpecial && passwordsMatch;
        
        if (!allRequirementsMet) {
            e.preventDefault();
            alert('Please ensure all password requirements are met and passwords match before submitting.');
            return false;
        }
    });

    // Initial check
    checkPassword();
    updateSubmitButton();
});
</script>
{% endblock %}